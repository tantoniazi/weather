<% content_for :title, "Cadastrar" %>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header bg-success text-white text-center">
          <h3 class="mb-0">
            <i class="fas fa-user-plus me-2"></i>
            Criar Conta
          </h3>
          <p class="mb-0 mt-2 opacity-75">
            Cadastre-se para acessar o sistema de clima
          </p>
        </div>
        <div class="card-body p-4">
          <%= form_for(resource, as: resource_name, url: registration_path(resource_name),
                                 html: { class: "needs-validation", novalidate: true }) do |f| %>
            
            <%= render "devise/shared/error_messages", resource: resource %>

            <div class="row">
              <div class="col-md-6 mb-3">
                <%= f.label :email, class: "form-label" do %>
                  <i class="fas fa-envelope me-1"></i>
                  Email *
                <% end %>
                <%= f.email_field :email,
                                  autofocus: true,
                                  autocomplete: "email",
                                  class: "form-control form-control-lg",
                                  placeholder: "seu@email.com",
                                  required: true %>
                <div class="invalid-feedback">
                  Por favor, insira um email válido.
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <%= f.label :address, "Endereço", class: "form-label" do %>
                  <i class="fas fa-map-marker-alt me-1"></i>
                  Endereço
                <% end %>
                <%= f.text_field :address,
                                 class: "form-control form-control-lg",
                                 placeholder: "Rua, número, bairro" %>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <%= f.label :country, "País", class: "form-label" do %>
                  <i class="fas fa-globe me-1"></i>
                  País
                <% end %>
                <%= f.text_field :country,
                                 class: "form-control form-control-lg",
                                 placeholder: "Brasil",
                                 value: "Brasil" %>
              </div>

              <div class="col-md-6 mb-3">
                <%= f.label :zip_code, "CEP", class: "form-label" do %>
                  <i class="fas fa-mail-bulk me-1"></i>
                  CEP
                <% end %>
                <%= f.text_field :zip_code,
                                 class: "form-control form-control-lg",
                                 placeholder: "00000-000",
                                 pattern: "[0-9]{5}-?[0-9]{3}" %>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <%= f.label :password, class: "form-label" do %>
                  <i class="fas fa-lock me-1"></i>
                  Senha *
                  <% if @minimum_password_length %>
                    <small class="text-muted">(mínimo <%= @minimum_password_length %> caracteres)</small>
                  <% end %>
                <% end %>
                <%= f.password_field :password,
                                     autocomplete: "new-password",
                                     class: "form-control form-control-lg",
                                     placeholder: "Sua senha",
                                     required: true,
                                     minlength: @minimum_password_length || 6 %>
                <div class="invalid-feedback">
                  A senha deve ter pelo menos <%= @minimum_password_length || 6 %> caracteres.
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <%= f.label :password_confirmation, "Confirmar Senha", class: "form-label" do %>
                  <i class="fas fa-lock me-1"></i>
                  Confirmar Senha *
                <% end %>
                <%= f.password_field :password_confirmation,
                                     autocomplete: "new-password",
                                     class: "form-control form-control-lg",
                                     placeholder: "Confirme sua senha",
                                     required: true %>
                <div class="invalid-feedback">
                  As senhas devem ser iguais.
                </div>
              </div>
            </div>

            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="terms" required>
              <label class="form-check-label" for="terms">
                Eu aceito os <a href="#" class="text-decoration-none">termos de uso</a> e 
                <a href="#" class="text-decoration-none">política de privacidade</a>
              </label>
            </div>

            <div class="d-grid">
              <%= f.submit "Criar Conta", class: "btn btn-success btn-lg" %>
            </div>
          <% end %>

          <hr class="my-4">

          <div class="text-center">
            <p class="mb-2">Já tem uma conta?</p>
            <%= link_to "Entrar", new_user_session_path,
                        class: "btn btn-outline-primary" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Password confirmation validation
document.addEventListener('DOMContentLoaded', function() {
  const password = document.querySelector('#user_password');
  const passwordConfirmation = document.querySelector('#user_password_confirmation');
  
  function validatePassword() {
    if (password.value !== passwordConfirmation.value) {
      passwordConfirmation.setCustomValidity('As senhas devem ser iguais');
    } else {
      passwordConfirmation.setCustomValidity('');
    }
  }
  
  password.addEventListener('change', validatePassword);
  passwordConfirmation.addEventListener('keyup', validatePassword);
});
</script>
